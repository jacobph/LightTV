"use strict";function debounce(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(){var a=this,d=arguments,o=function(){t=null,n||e.apply(a,d)},r=n&&!t;clearTimeout(t),t=setTimeout(o,s),r&&e.apply(a,d)}}function pad(e){return e<10?"0"+e:e}function isoString(e,t){return e.getUTCFullYear()+"-"+pad(e.getUTCMonth()+1)+"-"+pad(e.getUTCDate()+t)+"T"+pad(e.getUTCHours()-4)+":"+pad(e.getUTCMinutes())+"Z"}function renderControls(e){function t(){var e=document.body.scrollTop,t=m.offsetTop;document.querySelector(".section-live").offsetTop-240<=e?(u.classList.remove("fixed"),u.style=""):e+document.querySelector(".js_site-header").offsetHeight>=t?(u.classList.add("fixed"),u.style="width:"+m.offsetWidth+"px;"):(u.classList.remove("fixed"),u.style="")}var s=["January","February","March","April","May","June","July","August","September","October","November","December"],n=s[d.getMonth()].substring(0,3);document.querySelector(".js_schedule-controls__month span").innerText=n.toLowerCase();for(var a=["sun","mon","tue","wed","thu","fri","sat"],o=(e.getDay(),e.toString().split(" ")[0]),r=e.getDate(),i=a.indexOf(o.toLowerCase()),c="",l=0;l<7;l++)i+l>6&&(i=-l),c+='<div class="schedule-controls__week__day js_schedule-controls__week__day date-'+(r+l)+" js_date-"+(r+l)+" day-"+(l+1)+" js_controls-day-"+(l+1)+'" data-day="'+(l+1)+'" data-date="'+(r+l)+'">\n      <div class="day-name">'+a[i+l]+'</div>\n      <div class="day-num">'+(r+l)+"</div>\n    </div>";document.querySelector(".js_schedule-controls__week").innerHTML=c,document.querySelector(".js_controls-day-1").classList.add("active"),document.querySelectorAll(".js_schedule-controls__week__day").forEach(function(e){e.addEventListener("click",function(){document.getElementById("section-schedule").scrollIntoView(),updateScheduleState(parseInt(e.dataset.day))})}),document.querySelector(".schedule-controls__prev").addEventListener("click",function(){var e=scheduleState.dayActive-1;e<1&&(e=7),updateScheduleState(e),document.getElementById("section-schedule").scrollIntoView()}),document.querySelector(".schedule-controls__next").addEventListener("click",function(){var e=scheduleState.dayActive+1;e>7&&(e=1),updateScheduleState(e),document.getElementById("section-schedule").scrollIntoView()}),document.querySelector(".js_cs-loader").remove();var u=document.querySelector(".schedule-controls"),m=document.querySelector(".schedule-controls-wrapper");window.addEventListener("scroll",debounce(t))}function revealThumbnails(e,t){function s(){setTimeout(function(){e[n].src=e[n].dataset.src,e[n].classList.add("active"),++n<e.length&&s()},600)}var n=0;s()}function dataHandler(e){var t=new Date;renderControls(t);var s="",n=0,a=pad(t.getDate()),o=!1,r=!0;e.forEach(function(e){var t=e.startTime.indexOf("T"),i=e.startTime.indexOf(":"),c=e.startTime.indexOf("Z");e.startTime.substring(0,t)!==a?(a=e.startTime.substring(0,t),n++,o=!0):o=!1,o&&(s+="</div>",r?(s+='<div class="schedule__day js_schedule__day active schedule__day-'+n+" js_schedule__day-"+n+'" data-day="'+n+'">',r=!1):s+='<div class="schedule__day js_schedule__day schedule__day-'+n+" js_schedule__day-"+n+'" data-day="'+n+'">');var l=e.startTime.substring(t+1,i),u="am";l>12&&(l-=12,u="pm"),l<1&&(l=12);var m=e.startTime.substring(i+1,c),v="http://developer.tmsimg.com/assets/"+e.program.preferredImage.uri+"?api_key="+apikey;s+='<div class="program">\n      <div class="program__thumbnail">\n        <img class="img-responsive" src="" data-src="'+v+'" alt="'+e.program.title+'">\n      </div>\n      <div class="program__info">\n        <div class="program__info__left">\n          <div class="time">'+l+":"+m+u+'</div>\n        </div>\n        <div class="program__info__right">\n          <div class="title">'+e.program.title+'</div>\n          <div class="episode">',e.program.seasonNum&&(s+="S"+e.program.seasonNum),e.program.episodeNum&&(s+=".E"+e.program.episodeNum+" "),e.program.episodeTitle&&(s+=""+e.program.episodeTitle),s+="</div>",e.program.shortDescription&&(s+='<div class="description">'+e.program.shortDescription+"</div>");var p=d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate());e.program.releaseDate===p&&(s+='<div class="new"<span>New</span></div>'),s+=" </div></div></div>"}),s+="</div>",document.querySelector(".js_schedule").innerHTML=s,document.querySelector(".js_schedule-loading-wrapper").classList.remove("hidden"),revealThumbnails(document.querySelectorAll(".js_schedule__day-1 .program__thumbnail img"),document.querySelector(".js_schedule__day-1")),updateScheduleState(scheduleState.dayActive,JSON.stringify(e)),saveJSON()}function saveJSON(){sessionStorage.setItem("scheduleJSON",scheduleState.jsonResponse),sessionStorage.setItem("dateStored",d.getDate())}function getJSON(){return parseInt(sessionStorage.getItem("dateStored"))===d.getDate()?sessionStorage.getItem("scheduleJSON"):(sessionStorage.clear(),!1)}function updateScheduleState(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:scheduleState.jsonResponse;scheduleState.dayActive=e,scheduleState.jsonResponse=t,updateScheduleView(scheduleState)}function updateScheduleView(e){var t=e.dayActive;document.querySelector(".js_schedule-controls__week__day.active").classList.remove("active"),document.querySelector(".js_schedule__day.active").classList.remove("active"),document.querySelector(".js_controls-day-"+t).classList.add("active"),document.querySelector(".js_schedule__day-"+t).classList.add("active");var s=".js_schedule__day-"+t;revealThumbnails(document.querySelectorAll(".js_schedule__day-"+t+" .program__thumbnail img"),document.querySelectorAll(s))}function scheduleInit(){if(document.querySelector("#section-schedule")){var e=getJSON();e?dataHandler(JSON.parse(e)):jQuery.ajax({url:showtimesUrl,data:{startDateTime:isoStart,endDateTime:isoEnd,lineupId:lineupID,jsonp:"dataHandler",api_key:apikey},dataType:"jsonp"})}}function placeFinder(){var e=document.querySelector(".js_header-channel-finder");e.style="margin-bottom:-"+e.offsetHeight+"px",e.classList.remove("offpage")}function finderInit(){placeFinder(),window.addEventListener("resize",placeFinder),document.querySelector(".js_button-find").addEventListener("click",function(){this.classList.toggle("active"),document.querySelector(".js_header-channel-finder").classList.toggle("active"),document.querySelector(".js_button-finder-close").classList.toggle("hidden")}),document.querySelector(".js_button-finder-close").addEventListener("click",function(){document.querySelector(".js_header-channel-finder").classList.remove("active"),document.querySelector(".js_button-finder-close").classList.add("hidden")})}function displayResults(){var e=void 0,t=getParameter("aid"),s=getParameter("stnlt"),n=getParameter("nstnlt"),a=getParameter("lid"),d=getParameter("zip"),o="http://api.zap2it.com/tvlistings/webservices/channelFinder?rty=html";null!=t&&""!=t&&(o+="&aid="+t),null!=s&&""!=s&&(o+="&stnlt="+s),null!=n&&""!=n&&(o+="&nstnlt="+n),null!=a&&""!=a&&(o+="&lid="+a),null!=d&&""!=d&&(o+="&zip="+d),e='<div id="zcc-channelfinder-header"><h2>Light TV Channel Finder</h2></div>',e+='<script type="text/javascript" src="'+o+'"></script>',document.write(e)}function toggleMobileMenu(){document.querySelector(".js_mobile-menu").classList.toggle("active"),document.body.classList.toggle("mobile-menu-active")}function mobileMenuInit(){document.querySelector(".js_menu-open").addEventListener("click",function(){toggleMobileMenu()}),document.querySelector(".js_menu-close").addEventListener("click",function(){toggleMobileMenu()})}document.addEventListener("DOMContentLoaded",function(){console.log("DOMContentLoaded"),MediaBox(".mediabox")});var apikey="m5sb66gw46nh6cddagsumbtk",baseUrl="http://data.tmsapi.com/v1.1",stationID="97965",lineupID="USA-OTA11216",showtimesUrl=baseUrl+"/stations/"+stationID+"/airings",zipCode="78701",d=new Date,isoStart=isoString(d,0),isoEnd=isoString(d,6),scheduleState={dayActive:1,jsonResponse:""};jQuery(document).ready(function(){mobileMenuInit(),scheduleInit(),finderInit()});