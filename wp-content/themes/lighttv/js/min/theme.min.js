"use strict";function debounce(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(){var d=this,n=arguments,o=function(){t=null,a||e.apply(d,n)},i=a&&!t;clearTimeout(t),t=setTimeout(o,s),i&&e.apply(d,n)}}function pad(e){return e<10?"0"+e:e}function isoString(e,t){return e.getUTCFullYear()+"-"+pad(e.getUTCMonth()+1)+"-"+pad(e.getUTCDate()+t)+"T"+pad(e.getUTCHours()-4)+":"+pad(e.getUTCMinutes())+"Z"}function renderControls(e){function t(){var e=document.body.scrollTop,t=c.offsetTop;console.log(document.querySelector(".js_site-header").offsetHeight),document.querySelector(".section-live").offsetTop-240<=e?(r.classList.remove("fixed"),r.style=""):e+document.querySelector(".js_site-header").offsetHeight>=t?(r.classList.add("fixed"),r.style="width:"+c.offsetWidth+"px;"):(r.classList.remove("fixed"),r.style="")}for(var s=["sun","mon","tue","wed","thu","fri","sat"],a=(e.getDay(),e.toString().split(" ")[0]),d=e.getDate(),n=s.indexOf(a.toLowerCase()),o="",i=0;i<7;i++)n+i>6&&(n=-i),o+='<div class="schedule-controls__week__day js_schedule-controls__week__day date-'+(d+i)+" js_date-"+(d+i)+" day-"+(i+1)+" js_controls-day-"+(i+1)+'" data-day="'+(i+1)+'" data-date="'+(d+i)+'">\n      <div class="day-name">'+s[n+i]+'</div>\n      <div class="day-num">'+(d+i)+"</div>\n    </div>";document.querySelector(".js_schedule-controls__week").innerHTML=o,document.querySelector(".js_controls-day-1").classList.add("active"),document.querySelectorAll(".js_schedule-controls__week__day").forEach(function(e){e.addEventListener("click",function(){document.getElementById("section-schedule").scrollIntoView(),updateScheduleState(parseInt(e.dataset.day))})}),document.querySelector(".schedule-controls__prev").addEventListener("click",function(){var e=scheduleState.dayActive-1;e<1&&(e=7),updateScheduleState(e),document.getElementById("section-schedule").scrollIntoView()}),document.querySelector(".schedule-controls__next").addEventListener("click",function(){var e=scheduleState.dayActive+1;e>7&&(e=1),updateScheduleState(e),document.getElementById("section-schedule").scrollIntoView()}),document.querySelector(".js_cs-loader").remove();var r=document.querySelector(".schedule-controls"),c=document.querySelector(".schedule-controls-wrapper");window.addEventListener("scroll",debounce(t))}function revealThumbnails(e){function t(){setTimeout(function(){e[s].src=e[s].dataset.src,e[s].classList.add("active"),++s<e.length&&t()},600)}var s=0;t()}function dataHandler(e){var t=new Date;renderControls(t);var s="",a=0,n=pad(t.getDate()),o=!1,i=!0;e.forEach(function(e){var t=e.startTime.indexOf("T"),r=e.startTime.indexOf(":"),c=e.startTime.indexOf("Z");e.startTime.substring(0,t)!==n?(n=e.startTime.substring(0,t),a++,o=!0):o=!1,o&&(s+="</div>",i?(s+='<div class="schedule__day js_schedule__day active schedule__day-'+a+" js_schedule__day-"+a+'" data-day="'+a+'">',i=!1):s+='<div class="schedule__day js_schedule__day schedule__day-'+a+" js_schedule__day-"+a+'" data-day="'+a+'">');var l=e.startTime.substring(t+1,r),u="am";l>12&&(l-=12,u="pm"),l<1&&(l=12);var m=e.startTime.substring(r+1,c),v="http://developer.tmsimg.com/assets/"+e.program.preferredImage.uri+"?api_key="+apikey;s+='<div class="program">\n      <div class="program__thumbnail">\n        <img class="img-responsive" src="" data-src="'+v+'" alt="'+e.program.title+'">\n      </div>\n      <div class="program__info">\n        <div class="program__info__left">\n          <div class="time">'+l+":"+m+u+'</div>\n        </div>\n        <div class="program__info__right">\n          <div class="title">'+e.program.title+'</div>\n          <div class="episode">',e.program.seasonNum&&(s+="S"+e.program.seasonNum),e.program.episodeNum&&(s+=".E"+e.program.episodeNum+" "),e.program.episodeTitle&&(s+=""+e.program.episodeTitle),s+="</div>",e.program.shortDescription&&(s+='<div class="description">'+e.program.shortDescription+"</div>");var _=d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate());e.program.releaseDate===_&&(s+='<div class="new"<span>New</span></div>'),s+=" </div></div></div>"}),s+="</div>",document.querySelector(".js_schedule").innerHTML=s,document.querySelector(".js_schedule-loading-wrapper").classList.remove("hidden"),revealThumbnails(document.querySelectorAll(".js_schedule__day-1 .program__thumbnail img")),updateScheduleState(scheduleState.dayActive,JSON.stringify(e)),saveJSON()}function saveJSON(){sessionStorage.setItem("scheduleJSON",scheduleState.jsonResponse),sessionStorage.setItem("dateStored",d.getDate())}function getJSON(){return parseInt(sessionStorage.getItem("dateStored"))===d.getDate()?sessionStorage.getItem("scheduleJSON"):(sessionStorage.clear(),!1)}function updateScheduleState(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:scheduleState.jsonResponse;scheduleState.dayActive=e,scheduleState.jsonResponse=t,updateScheduleView(scheduleState)}function updateScheduleView(e){var t=e.dayActive;document.querySelector(".js_schedule-controls__week__day.active").classList.remove("active"),document.querySelector(".js_schedule__day.active").classList.remove("active"),document.querySelector(".js_controls-day-"+t).classList.add("active"),document.querySelector(".js_schedule__day-"+t).classList.add("active"),revealThumbnails(document.querySelectorAll(".js_schedule__day-"+t+" .program__thumbnail img"))}function scheduleInit(){if(document.querySelector("#section-schedule")){var e=getJSON();e?dataHandler(JSON.parse(e)):jQuery.ajax({url:showtimesUrl,data:{startDateTime:isoStart,endDateTime:isoEnd,lineupId:lineupID,jsonp:"dataHandler",api_key:apikey},dataType:"jsonp"})}}function placeFinder(){var e=document.querySelector(".js_header-channel-finder");e.style="margin-bottom:-"+e.offsetHeight+"px",e.classList.remove("offpage")}function finderInit(){placeFinder(),window.addEventListener("resize",placeFinder),document.querySelector(".js_button-find").addEventListener("click",function(){this.classList.toggle("active"),document.querySelector(".js_header-channel-finder").classList.toggle("active")})}function toggleMobileMenu(){document.querySelector(".js_mobile-menu").classList.toggle("active"),document.body.classList.toggle("mobile-menu-active")}function mobileMenuInit(){document.querySelectorAll(".js_menu-toggle").forEach(function(e){e.addEventListener("click",function(){toggleMobileMenu()})})}document.addEventListener("DOMContentLoaded",function(){console.log("DOMContentLoaded"),MediaBox(".mediabox")});var apikey="m5sb66gw46nh6cddagsumbtk",baseUrl="http://data.tmsapi.com/v1.1",stationID="81334",lineupID="USA-OTA11216",showtimesUrl=baseUrl+"/stations/"+stationID+"/airings",zipCode="78701",d=new Date,isoStart=isoString(d,0),isoEnd=isoString(d,6),scheduleState={dayActive:1,jsonResponse:""};jQuery(document).ready(function(){mobileMenuInit(),scheduleInit(),finderInit()});